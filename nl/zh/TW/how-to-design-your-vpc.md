---

copyright:
  years: 2017, 2018, 2019
lastupdated: "2019-05-14"

keywords: VPC, subnet, address prefixes, design, addressing

subcollection: vpc-on-classic-network

---

{:shortdesc: .shortdesc}
{:codeblock: .codeblock}
{:screen: .screen}
{:new_window: target="_blank"}
{:pre: .pre}
{:tip: .tip}
{:note: .note}
{:table: .aria-labeledby="caption"}
{:download: .download}


# 設計 VPC 的定址方案 
{: #vpc-addressing-plan-design}

設計 VPC 的第一步應該是設計您的定址方案。適當執行的定址方案有兩個目標：

* 它符合 VPC 實例的通訊需求。
* 它會維護未來成長的彈性。 

本文件為三層 Web 應用程式提供了設計定址方案的範例，其中每個層級都受多個區域支援。

雖然每一個 {{site.data.keyword.cloud}} VPC 都部署至特定地區，但 VPC 可能會橫跨該地區內的所有區域。{{site.data.keyword.cloud_notm}} VPC 會定義每個區域的預設位址字首。這些位址字首可透過提供[隱含路由器](/docs/vpc-on-classic?topic=vpc-on-classic-vpc-glossary#implicit-router)需要的區域相關遞送資訊，在不同區域的 {{site.data.keyword.cloud_notm}} VPC 實例之間啟用通訊。

不論應用程式是否完全包含在雲端上，或者應用程式的組件是否都在其他位置執行，都涉及相同的設計步驟。
{: tip}

## 設計考量與假設
{: #design-considerations-and-assumptions}

在設計應用程式的定址方案時，主要考量是保留 CIDR 區塊，用來在單一區域內盡可能建立連續的子網路。這麼做之後，設計者可讓您以單一位址字首彙總它們，以保留未來成長的空間。

另一個考量是子網路進行水平調整可能需要的可用位址數目。下表根據指定的 CIDR 區塊大小，列出子網路中的可用位址數目：

| CIDR 區塊大小 | 可用的位址 |
| --------------- | ------------------- |
|      /22        |        1019         |
|      /23        |         507         |
|      /24        |         251         |
|      /25        |         123         |
|      /26        |          59         |
|      /27        |          27         |
|      /28        |          11         |

根據這兩項考量，以下是我們為此範例所做的假設：

* 在這個範例中，來自 RFC 1918 位址之 172.16.0.0/12 區塊的 CIDR 範圍將用於所有子網路。
* 我們假設應用程式呈現層是 REST API 上方的薄外層。因此，水平調整對中間層的影響超過對呈現層的影響。

## 判斷每個層級的子網路大小
{: #determine-each-tier-s-subnet-size}

下一步是判斷每個層級的子網路大小（就可用位址來說）。應用程式的每一層都存在於每個區域中，因此每一個區域需要三個子網路。

以下是規劃每個層級的子網路大小時所使用的考量：

* 資料庫層（後端系統）是最不可能需要動態調整的層級，因此這些子網路可能是最小的。也就是說，這些子網路可能包含最少的可用位址數目。 
    * _這個範例使用 `/27` CIDR 區塊，表示在此層級中容許 27 個位址。_
* 中間層是最可能需要動態調整的層級，因此這些子網路將會是最大的。也就是說，它們必須包含最多的可用位址數目。 
    * _這個範例使用 `/25` CIDR 區塊，表示在此層級中容許 123 個位址。_
* 前端系統層級則介於兩者之間；它需要的位址數目不像中間層那麼多，但超過資料庫層所需的數目。 
    * _這個範例使用 `/26` CIDR 區塊，表示在此層級中容許 59 個位址。_

## 結合子網路及選取位址字首
{: #combining-the-subnets-and-selecting-the-address-prefixes}

若要為每一個區域選取可接受的位址字首，您需要一個夠大的子網路大小，足以在每個層級中容納全部三個子網路，但仍保留空間供水平調整及未來擴充使用。 

`/24` 位址字首是可以結合這三個子網路 (27 + 123 + 59) 的最小字首。最佳作法是建議選取下一個較大的子網路大小，而非最小大小。指派下一個較大的子網路大小 (`/23`) 允許水平調整超出先前給定的限制，因為它容許將新的子網路從相同的位址字首內新增至每一層。

既然我們已決定正確的子網路大小，則可以指派實際的位址字首，每個區域一個字首：

| 區域 | 位址字首  |
| ------ | --------------- |
| 區域 1 | `172.16.0.0/23` |
| 區域 2 | `172.16.2.0/23` |
| 區域 3 | `172.16.4.0/23` |

根據此基礎，可以指派每個區域內的 3 個子網路：

| 區域 | 層級 |子網路 CIDR|
| ------ | -------- | ----------------- |
| 區域 1 |  中間  | `172.16.0.0/25`  |
| 區域 1 |  前端  | `172.16.1.0/26`  |
| 區域 1 | 資料庫 | `172.16.1.128/27` |
| 區域 2 |  中間  | `172.16.2.0/25`  |
| 區域 2 |  前端  | `172.16.3.0/26`  |
| 區域 2 | 資料庫 | `172.16.3.128/27` |
| 區域 3 |  中間  | `172.16.4.0/25`  |
| 區域 3 |  前端  | `172.16.5.0/26`  |
| 區域 3 | 資料庫 | `172.16.5.128/27` |

## 擴充現有基礎架構的考量
{: #considerations-for-extending-an-existing-infrastructure}

當您規劃可擴充現有基礎架構的 VPC 時，不論基礎架構是您的內部部署基礎架構、另一個 VPC 還是其他雲端，您都可以遵循先前的步驟。請記住，您不得重複使用現有的位址範圍。藉由避免重複使用位址，您可以充分利用 {{site.data.keyword.cloud_notm}} VPC 特性。
