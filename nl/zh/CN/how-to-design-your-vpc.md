---

copyright:
  years: 2017, 2018, 2019
lastupdated: "2019-05-14"

keywords: VPC, subnet, address prefixes, design, addressing

subcollection: vpc-on-classic-network

---

{:shortdesc: .shortdesc}
{:codeblock: .codeblock}
{:screen: .screen}
{:new_window: target="_blank"}
{:pre: .pre}
{:tip: .tip}
{:note: .note}
{:table: .aria-labeledby="caption"}
{:download: .download}


# 设计 VPC 的寻址计划 
{: #vpc-addressing-plan-design}

设计 VPC 的第一步应该是设计您的寻址计划。正确执行的寻址计划有两个目标：

* 满足 VPC 实例的通信需求。
* 保持未来增长的灵活性。 

本文档提供了设计三层 Web 应用程序的寻址计划的示例，其中每个层都由多个专区支持。

虽然每个 {{site.data.keyword.cloud}} VPC 部署到特定区域，但该 VPC 可能跨越该区域内的所有专区。{{site.data.keyword.cloud_notm}} VPC 定义每个专区的缺省地址前缀。这些地址前缀通过提供[隐式路由器](/docs/vpc-on-classic?topic=vpc-on-classic-vpc-glossary#implicit-router)需要的与专区相关的路由信息，在不同专区中的 {{site.data.keyword.cloud_notm}} VPC 实例之间启用通信。

无论应用程序是完全包含在云上还是其中某些部分在其他位置运行，都涉及相同的设计步骤。
{: tip}

## 设计注意事项和假设
{: #design-considerations-and-assumptions}

在设计应用程序的寻址计划时，主要考虑是将用于在单个专区中创建子网的 CIDR 块保持尽可能相邻。这样设计人员就允许在单个地址前缀中对其进行汇总，从而为未来的增长留下空间。

另一个注意事项是子网可能需要用于水平扩展的可用地址数。下表根据指定的 CIDR 块大小，列出子网中的可用地址数：

| CIDR 块大小 | 可用地址数 |
| --------------- | ------------------- |
|      /22        |        1019         |
|      /23        |         507         |
|      /24        |         251         |
|      /25        |         123         |
|      /26        |          59         |
|      /27        |          27         |
|      /28        |          11         |

基于这两个注意事项，下面是我们针对此示例所做的假设：

* 对于此示例，来自 RFC 1918 地址的 172.16.0.0/12 块的 CIDR 范围将用于所有子网。
* 我们假定应用程序的表示层是 REST API 之上的一层薄单板。因此，水平缩放对中间层的影响比对表示层的影响更大。

## 确定每层的子网大小
{: #determine-each-tier-s-subnet-size}

下一步是确定每层的子网大小（在可用地址数方面）。应用程序的每层在每个专区中都存在，因此每个专区将需要三个子网。

以下是规划每层的子网大小时需要考虑的注意事项：

* 数据库层（后端）最不可能需要动态缩放，所以这些子网可能是最小的。即，这些子网包含的可用地址数量可能是最少的。 
    * _此示例使用 `/27` CIDR 块，它允许此层中有 27 个地址。_
* 中间层最有可能需要动态缩放，因此这些子网将是最大的。即，它们包含的可用地址数一定是最多的。 
    * _此示例使用 `/25` CIDR 块，它允许此层中有 123 个地址。_
* 前端层居中；它所需要的地址数不像中间层那么多，但比数据库层要多一些。 
    * _此示例使用 `/26` CIDR 块，它允许此层中有 59 个地址。_

## 组合子网并选择地址前缀
{: #combining-the-subnets-and-selecting-the-address-prefixes}

要为每个专区选择可接受的地址前缀，您需要足够大的子网大小来容纳每层中的所有三个子网，同时仍为水平缩放和未来扩展留下空间。 

`/24` 地址前缀是这三个子网可以组合成的最小前缀 (27 + 123 + 59)。我们建议的最佳做法是，选择下一个较大的子网大小，而不是最小的子网大小。分配下一个较大的子网大小 (`/23`) 允许水平缩放超过先前给定的限制，因为它允许在同一地址前缀中向每个层添加新的子网。

既然我们确定了正确的子网大小，接下来就可以为每个专区分配一个实际地址前缀：

|专区| 地址前缀|
| ------ | --------------- |
| 专区 1 | `172.16.0.0/23` |
| 专区 2 | `172.16.2.0/23` |
|专区 3| `172.16.4.0/23` |

在此基础上，可以分配每个专区中的 3 个子网：

|专区|层|子网 CIDR|
| ------ | -------- | ----------------- |
| 专区 1 |  中间  |  `172.16.0.0/25`  |
| 专区 1 |  前端  |  `172.16.1.0/26`  |
| 专区 1 | 数据库 | `172.16.1.128/27` |
| 专区 2 |  中间  |  `172.16.2.0/25`  |
| 专区 2 |  前端  |  `172.16.3.0/26`  |
| 专区 2 | 数据库 | `172.16.3.128/27` |
|专区 3|  中间  |  `172.16.4.0/25`  |
|专区 3|  前端  |  `172.16.5.0/26`  |
|专区 3| 数据库 | `172.16.5.128/27` |

## 扩展现有基础架构的注意事项
{: #considerations-for-extending-an-existing-infrastructure}

当您计划扩展现有基础架构的 VPC 时，可以遵循先前的步骤，无论该基础架构是内部部署基础架构、另一个 VPC，还是其他云。请记住，不能复用现有地址范围。通过避免地址复用，您可以最大程度地利用 {{site.data.keyword.cloud_notm}} VPC 功能。
