---

copyright:
  years: 2017, 2018, 2019
lastupdated: "2019-05-14"

keywords: VPC, subnet, address prefixes, design, addressing

subcollection: vpc-on-classic-network

---

{:shortdesc: .shortdesc}
{:codeblock: .codeblock}
{:screen: .screen}
{:new_window: target="_blank"}
{:pre: .pre}
{:tip: .tip}
{:note: .note}
{:table: .aria-labeledby="caption"}
{:download: .download}


# VPC のアドレス指定計画の設計 
{: #vpc-addressing-plan-design}

VPC の設計における最初の手順は、アドレス指定計画を設計することです。適切に実施されるアドレス指定計画では、次の 2 つを目標とします。

* VPC インスタンスの通信要件を満たす。
* 将来の成長のために柔軟性を確保する。 

この資料では、3層の Web アプリケーションのアドレス指定計画を設計する例を示します。各層は複数のゾーンでサポートされます。

各 {{site.data.keyword.cloud}} VPC は 1 つの特定のリージョンにデプロイされますが、VPC はそのリージョン内のすべてのゾーンにまたがることができます。{{site.data.keyword.cloud_notm}} VPC は、すべてのゾーンのデフォルトのアドレス接頭部を定義します。これらのアドレス接頭部によって、[暗黙ルーター](/docs/vpc-on-classic?topic=vpc-on-classic-vpc-glossary#implicit-router)が必要とするゾーン関連のルーティング情報が提供され、別々のゾーンにある {{site.data.keyword.cloud_notm}} VPC インスタンスの間の通信が可能になります。

アプリケーションが完全にクラウドに含まれているか、一部が別のロケーションで実行されているかにかかわらず、同じ設計手順が必要になります。
{: tip}

## 設計上の考慮事項と想定事項
{: #design-considerations-and-assumptions}

アプリケーションのアドレス指定計画を設計する際の第一の考慮事項は、単一ゾーン内にサブネットを作成するために使用する CIDR ブロックを、できるだけ連続したものにすることです。そうすれば、設計担当者がそれらのブロックを単一のアドレス接頭部にまとめて、将来の成長のための余地を残すことができます。

もう 1 つの考慮事項は、水平スケーリングのために必要になるサブネットの使用可能なアドレス数です。以下の表に、サブネットの使用可能なアドレス数を CIDR ブロック・サイズの指定別に示します。

| CIDR ブロック・サイズ | 使用可能なアドレス数 |
| --------------- | ------------------- |
|      /22        |        1019         |
|      /23        |         507         |
|      /24        |         251         |
|      /25        |         123         |
|      /26        |          59         |
|      /27        |          27         |
|      /28        |          11         |

これら 2 つの考慮事項に基づいて、この例での前提事項を以下に示します。

* この例では、RFC 1918 アドレスの 172.16.0.0/12 ブロックの CIDR 範囲をすべてのサブネットに使用します。
* アプリケーションのプレゼンテーション層は REST API の上にある薄い層であると想定します。そのため、水平スケーリングから受ける影響は、プレゼンテーション層よりも中間層のほうが大きくなります。

## 各層のサブネット・サイズの決定
{: #determine-each-tier-s-subnet-size}

次の手順は、各層のサブネット・サイズを (使用可能なアドレス数の観点から) 決定することです。アプリケーションのすべての層が各ゾーンに存在するので、各ゾーンに 3 つのサブネットが必要です。

各層のサブネット・サイズを計画する際に使用する考慮事項を以下に示します。

* データベース層 (バックエンド) は、動的なスケーリングが必要になる可能性が最も低いため、これらのサブネットは最小にすることができます。つまり、これらのサブネットは、使用可能なアドレス数が最も少ないものにすることができます。 
    * _この例では、`/27` CIDR ブロックを使用します。つまり、この層では 27 個のアドレスを使用できます。_
* 中間層は、動的スケーリングが必要になる可能性が最も高いため、これらのサブネットが最大になります。つまり、使用可能なアドレス数が最も多いものにする必要があります。 
    * _この例では、`/25` CIDR ブロックを使用します。つまり、この層では 123 個のアドレスを使用できます。_
* フロントエンド層は、中間に位置します。つまり、中間層ほど多くの数のアドレスは必要ありませんが、データベース層よりも多くのアドレスを必要とします。 
    * _この例では、`/26` CIDR ブロックを使用します。つまり、この層では 59 個のアドレスを使用できます。_

## サブネットの集約とアドレス接頭部の選択
{: #combining-the-subnets-and-selecting-the-address-prefixes}

ゾーンごとに許容可能なアドレス接頭部を選択するには、各層の 3 つのサブネットをすべて包含しつつ、水平スケーリングや将来の拡張のための余地も残した大きさのサブネット・サイズを求める必要があります。 

`/24` アドレス接頭部が、これらの 3 つのサブネットを集約できる最小の接頭部です (27 + 123 + 59)。ベスト・プラクティスとして、最も小さいものではなく、次に小さいサブネット・サイズを選択することをお勧めします。次に小さいサブネット・サイズ (`/23`) を割り当てると、同じアドレス接頭部内から各層に新しいサブネットを追加できるので、前述の制限を超えた水平スケーリングが可能になります。

適切なサブネット・サイズを決定したので、実際のアドレス接頭部を各ゾーンに 1 つずつ割り当てることができます。

| ゾーン | アドレス接頭部 |
| ------ | --------------- |
| ゾーン 1 | `172.16.0.0/23` |
| ゾーン 2 | `172.16.2.0/23` |
| ゾーン 3 | `172.16.4.0/23` |

これを基に、各ゾーン内に 3 つのサブネットを割り当てることができます。

| ゾーン | 層 | サブネット CIDR |
| ------ | -------- | ----------------- |
| ゾーン 1 | 中間 |  `172.16.0.0/25`  |
| ゾーン 1 | フロント |  `172.16.1.0/26`  |
| ゾーン 1 | データベース | `172.16.1.128/27` |
| ゾーン 2 | 中間 |  `172.16.2.0/25`  |
| ゾーン 2 | フロント |  `172.16.3.0/26`  |
| ゾーン 2 | データベース | `172.16.3.128/27` |
| ゾーン 3 | 中間 |  `172.16.4.0/25`  |
| ゾーン 3 | フロント |  `172.16.5.0/26`  |
| ゾーン 3 | データベース | `172.16.5.128/27` |

## 既存のインフラストラクチャーの拡張に関する考慮事項
{: #considerations-for-extending-an-existing-infrastructure}

既存のインフラストラクチャーを拡張する VPC を計画する場合にも、上記の手順に従うことができます。そのインフラストラクチャーがオンプレミス・インフラストラクチャーであろうと、別の VPC であろうと、別のクラウドであろうと関係ありません。既存のアドレス範囲を再使用してはいけないことに注意してください。アドレスを再使用しないことで、{{site.data.keyword.cloud_notm}} VPC 機能を最大限に利用できます。
